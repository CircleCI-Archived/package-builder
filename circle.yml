machine:
  pre:
    - sudo curl -L -o /usr/bin/docker 'https://s3-external-1.amazonaws.com/circle-downloads/docker-1.9.1-circleci'
    - sudo chmod 0755 /usr/bin/docker

  services:
    - docker

dependencies:
  pre:
    - gem install package_cloud

test:
  override:
    - ./build-package ruby   2.2.3
    - ./build-package ruby   2.2.2
    - ./build-package python 2.7.9

deployment:
  production:
    branch: master
    commands:
      # Packagecloud doesn't allow to override, so only new packages will be pushed.
      - for p in $(find ./ | grep _amd64.deb); do package_cloud push circleci/circleci/ubuntu/trusty $p; done; true
