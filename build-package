#!/bin/bash

set -e
set -x

package=$1
version=$2
install_dir=$3
deb=circleci-${package}${version}_0.0.1_amd64.deb

cd $package

pushd src/
docker build --build-arg package=${package} \
             --build-arg version=${version} \
             --build-arg install_dir=${install_dir} \
             -t kimh/package_builder .

docker run package-builder cat $deb > ../$deb
popd

#if [ -f test/Dockerfile ]; then
#    pushd test/
#    cp ../$deb .
#    docker build --build-arg package=${package} --build-arg version=${version} --build-arg install_dir=${install_dir} -t kimh/${package}-test:${version} .
#    popd
#fi

